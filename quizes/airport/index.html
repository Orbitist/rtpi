<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Fullscreen Orbitist Map</title>
		<meta name="description" content="A beautiful map made with Orbitist">
		<meta name="author" content="Orbitist">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-title" content="Orbitist">
		<meta property="og:title"           content="Another amazing map made with Orbitist.com!" /> 
		<meta property="og:image"           content="https://orbitist.s3.amazonaws.com/_toplevel/images/backgrounds/mobile_orbitist.jpg" />
		<link rel="apple-touch-startup-image" href="https://orbitist.s3.amazonaws.com/_toplevel/images/logos/splash.png">
		<link rel="apple-touch-icon" sizes="120x120" href="https://orbitist.s3.amazonaws.com/_toplevel/images/logos/1000_illustrated.jpg">

		<!-- HTML5 element support for IE6-8 -->
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<!-- CartoDB CSS and JS. Includes Jquery and Leaflet -->
		<link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
		<script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
		<script src="http://app.orbitist.com/launch/cdn/orbitist-js/leaflet-hash.js"></script>
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-js/leaflet-markercluster/dist/MarkerCluster.css" />
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-js/leaflet-markercluster/dist/MarkerCluster.Default.css" />
		<script src="http://app.orbitist.com/launch/cdn/orbitist-js/leaflet-markercluster/dist/leaflet.markercluster-src.js"></script>
		
		<!-- Leaflet Locate Control -->
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-js/leaflet-locatecontrol/dist/L.Control.Locate.min.css" />
		<!--[if lt IE 9]>
			<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-js/leaflet-locatecontrol/dist/L.Control.Locate.ie.min.css"/>
		<![endif]-->
		<script src="http://app.orbitist.com/launch/cdn/orbitist-js/leaflet-locatecontrol/dist/L.Control.Locate.min.js" ></script>

		<!-- Font Awesome CSS -->
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	
		<!-- Lightbox -->
		<script src="http://app.orbitist.com/launch/plugins/lightbox/js/lightbox.min.js"></script>
		<link href="http://app.orbitist.com/launch/plugins/lightbox/css/lightbox.css" rel="stylesheet" />
		
		<!-- Twitter Widjet Script -->
		<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
		
		<!-- Wistia Embed Script -->
		<script charset="ISO-8859-1" src="//fast.wistia.com/assets/external/E-v1.js" async></script>
		
<!-- Wofoo form CSS -->
<link href="css/form.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">


		<!-- Custom CSS -->
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-css/style.css">
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-css/fullscreen.css">
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-css/leaflet.css">
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-css/icons.css">
		<link rel="stylesheet" href="http://app.orbitist.com/launch/cdn/orbitist-css/top-level.css">
		
	</head>
	<body>
		<!-- Spinner -->
		<div class="spinner">
			<div class="sk-spinner sk-spinner-pulse"></div>
		</div>

		<!-- map -->
		<div class="map" id="map"></div>
		
		
		<!-- map info button -->
		<div class="fullscreen-toggle z10">
     		<button type="button" class="map-button btnmapinfo"><i class="fa fa-question-circle"></i> View Quiz</button>
		</div><!-- fullscreen-toggle -->

		<!-- Story Slide -->
		<div class="story-slide z20 in">
			<button type="button" class="map-button btnmapinfo btnmapinfo-close in" aria-label="Close"><i class="fa fa-times"></i></button>
			<div class="mapinfo"></div>
			<div class="explore-container">
<!-- wufoo form -->
<script src="scripts/wufoo.js"></script>				
<form id="form2" name="form2" class="wufoo topLabel page" accept-charset="UTF-8" autocomplete="off" enctype="multipart/form-data" method="post" novalidate
      action="https://orbitist.wufoo.com/forms/mu5cxbd1eqlu34/#public">
      
<ul><li id="foli1" class="notranslate      ">
<fieldset>
<![if !IE | (gte IE 8)]>
<legend id="title1" class="desc">
Which architectural wonder does not have any religious connection to it?
</legend>
<![endif]>
<!--[if lt IE 8]>
<label id="title1" class="desc">
Which architectural wonder does not have any religious connection to it?
</label>
<![endif]-->
<div>
<input id="radioDefault_1" name="Field1" type="hidden" value="" />
<span>
<input id="Field1_0" name="Field1" type="radio" class="field radio" value="La Sagrada Familia" tabindex="1"     />
<label class="choice" for="Field1_0" >
<span class="choice__text">La Sagrada Familia</span>
<span class="choice__qty">
</span>
</label>
</span>
<span>
<input id="Field1_1" name="Field1" type="radio" class="field radio" value="La Alhambra" tabindex="2"     />
<label class="choice" for="Field1_1" >
<span class="choice__text">La Alhambra</span>
<span class="choice__qty">
</span>
</label>
</span>
<span>
<input id="Field1_2" name="Field1" type="radio" class="field radio" value="Aqueduct of Segovia" tabindex="3"     />
<label class="choice" for="Field1_2" >
<span class="choice__text">Aqueduct of Segovia</span>
<span class="choice__qty">
</span>
</label>
</span>
<span>
<input id="Field1_3" name="Field1" type="radio" class="field radio" value="La Plaza Mayor of Salamanca" tabindex="4"     />
<label class="choice" for="Field1_3" >
<span class="choice__text">La Plaza Mayor of Salamanca</span>
<span class="choice__qty">
</span>
</label>
</span>
</div>
</fieldset>
</li>
<li id="foli3"
class="notranslate      "><label class="desc" id="title3" for="Field3">
Spain has taken many steps to preserve these architectural wonders. Why does a country work so hard to do this? List and explain a few possible reasons.
</label>

<div>
<textarea id="Field3"
name="Field3"
class="field textarea medium"
spellcheck="true"
rows="10" cols="50"

tabindex="5"
onkeyup=""
       ></textarea>

</div>
</li>
<li id="foli4"
class="notranslate      "><label class="desc" id="title4" for="Field4">
The United States is a relatively new country when compared to Spain. What are some architectural wonders in the U.S. and why are they important to the American people?
</label>

<div>
<textarea id="Field4"
name="Field4"
class="field textarea medium"
spellcheck="true"
rows="10" cols="50"

tabindex="6"
onkeyup=""
       ></textarea>

</div>
</li>
<li id="foli5"
class="notranslate      "><label class="desc" id="title5" for="Field5">
What are the reasons for building these architectural wonders in Spain in the first place?
</label>

<div>
<textarea id="Field5"
name="Field5"
class="field textarea medium"
spellcheck="true"
rows="10" cols="50"

tabindex="7"
onkeyup=""
       ></textarea>

</div>
</li>
<li id="foli6" class="notranslate      ">
<label class="desc" id="title6" for="Field6">
What is the oldest architectural wonder on this map? 
</label>
<div>
<input id="Field6" name="Field6" type="text" class="field text medium" value="" maxlength="255" tabindex="8" onkeyup=""       />
</div>
</li>
<li id="foli7" class="notranslate      ">
<label class="desc" id="title7" for="Field7">
What is the newest architectural wonder on this map?
</label>
<div>
<input id="Field7" name="Field7" type="text" class="field text medium" value="" maxlength="255" tabindex="9" onkeyup=""       />
</div>
</li>
<li id="foli8"
class="notranslate      "><label class="desc" id="title8" for="Field8">
Which wonder would you most like to visit and why?
</label>

<div>
<textarea id="Field8"
name="Field8"
class="field textarea medium"
spellcheck="true"
rows="10" cols="50"

tabindex="10"
onkeyup=""
       ></textarea>

</div>
</li> <li class="buttons ">
<div>

                    <input id="saveForm" name="saveForm" class="btTxt submit"
    type="submit" value="Submit"
 /></div>
</li>

<li class="hide">
<label for="comment">Do Not Fill This Out</label>
<textarea name="comment" id="comment" rows="1" cols="1"></textarea>
<input type="hidden" id="idstamp" name="idstamp" value="MB6JcjJboKp6yAbcIgX45oZHq2qm4B+LuWwcGoJgd+Q=" />
</li>
</ul>

</form>
			</div><!-- explore-container -->
		</div><!-- story-slide -->
		
		

		<!-- Bootstrap JS -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		
		<!-- Orbitist Custom scripts -->
		<script src="http://app.orbitist.com/launch/cdn/orbitist-js/custom.js"></script>

		
		
<script>
var mapId = 1653;
		
// Retrieve map info
$(document).ready(
    function(){
        $.getJSON(
            'http://app.orbitist.com/api/v1/map.json?mapid=' + mapId,
            function(data){
                // ciclo l'array
                for(i=0; i<data.length; i++){
                    var  content  = '<img src="';
                         content +=  data[i].map_image;
                         content  += '" class="img-responsive">';
                    	 	 content  += '<div class="story-slide-content"><h4>';
                         content +=  data[i].map_title;
                         content  += '</h4>';
                         content +=  data[i].map_body;
                         content +=  '</div>';
                         cartodbkey =  data[i].map_cartodb;
                         basemapurl =  data[i].map_tiles;
                         custombasemapurl = data[i].map_custom_tiles;
                         customcss = data[i].map_css;
                         googleanalytics = data[i].map_google_analytics;
                    $('div.mapinfo').append(content);
                    $('head').append('<style>' + customcss + '</style>');

					// Add cartodb layer
					cartodb.createLayer(map, cartodbkey).addTo(map);
					// Add ZXY tile layers
					if ( basemapurl.length > 10 ) {
						L.tileLayer(basemapurl, {
							attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors © <a href="http://mapbox.com/map-feedback/">Mapbox</a>'
						}).addTo(map);
					}
					if ( custombasemapurl.length > 10 ) {
						L.tileLayer(custombasemapurl).addTo(map);
					}
	//Google Analytics				
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  //If user submitted google analytics cods
	if ( googleanalytics.length > 5 ) {
		ga('create', googleanalytics, 'auto', {'name':'b'});
		ga('create', 'UA-50308061-3', 'auto');
		ga('send', 'pageview');
		ga('b.send', 'pageview');
	}
	//Otherwise just load the Orbitist Tracking code
	else {
		ga('create', 'UA-50308061-3', 'auto');
		ga('send', 'pageview');
	}
					
                }
            }
        );
    }
);

// Set lat/long where the map initiates and at what zoom level
var map = new L.Map('map',{maxZoom: 18});





// Get points //
var json = (function () {
    var json = null;
    $.ajax({
        'async': false,
        'global': false,
        'url': 'http://app.orbitist.com/api/v1/points/' +  mapId + '.json',
        'dataType': "json",
        'success': function (data) {
            json = data;
        }
    });
    return json;
})(); 
 
var orbitistGeoJson = json;
  
// ADVANCED: This tells the map what goes in popups.
function orbitistPopup(feature, layer) {
    // does this feature have an image?
    if (feature.properties.point_image.length > 2) {
        layer.bindPopup(
        	'<a href="' + feature.properties.point_image + '" data-lightbox="' + feature.properties.point_id + '" data-title="' + feature.properties.point_image_caption + '"><img src="' + feature.properties.point_thumbnail + '" width="301px" height="270px" class="popup-top-image"><div class="popupimage-expand"><span class="fa fa-clone"></span></div></a>' + feature.properties.point_lightbox_images + '<div class="popupbody"><div class="popuptitle"><h3>' + feature.properties.point_title + '</h3></div>' + feature.properties.point_embeds + feature.properties.point_body + feature.properties.point_links + '<div class="action-items"><div class="col-xs-6"><a href="https://www.google.com/maps/dir/Current+Location/' + feature.geometry.coordinates[1] + ',' + feature.geometry.coordinates[0] + '" target="_blank"><span class="fa fa-car center-block"></span></a></div><div class="col-xs-6"><a href="https://app.orbitist.com/print/' + feature.properties.point_id + '" target="_blank"><span class="fa fa-print center-block"></span></a></div></div></div>',
        	{closeButton: false}
        );
    } else {
        layer.bindPopup(
        	'<div class="popupbody"><div class="popuptitle"><h3>' + feature.properties.point_title + '</h3></div>' + feature.properties.point_embeds + feature.properties.point_body + feature.properties.point_links + '<div class="action-items"><div class="col-xs-6"><a href="https://www.google.com/maps/dir/Current+Location/' + feature.geometry.coordinates[1] + ',' + feature.geometry.coordinates[0] + '" target="_blank"><span class="fa fa-car center-block"></span></a></div><div class="col-xs-6"><a href="https://app.orbitist.com/print/' + feature.properties.point_id + '" target="_blank"><span class="fa fa-print center-block"></span></a></div></div></div>',
        	{closeButton: false}
        );
    }
}

// Set cluster var
var markers = L.markerClusterGroup({maxClusterRadius: 25, disableClusteringAtZoom: 17});

// Add markers to map based on geojson
var geoJsonLayer = L.geoJson(orbitistGeoJson, {
	pointToLayer: function(feature, latlng) {
	   var smallIcon = L.divIcon({
className: feature.properties.point_marker_class,
iconSize: [30, 30],
iconAnchor: [15, 30],
popupAnchor: [0, -28]
	   });
	   return L.marker(latlng, {icon: smallIcon});
	},
    onEachFeature: orbitistPopup
});

markers.addLayer(geoJsonLayer);
map.addLayer(markers);
map.fitBounds(markers.getBounds());

// Use leaflet hash
var hash = new L.Hash(map);
// Use leaflet locate control
L.control.locate().addTo(map);
</script>

<!-- spinner -->
<script>
$(document).ready(function() {
	$(this).find(".spinner").delay(2000).fadeOut(500, function () {
		$(this).remove();
	});
});
</script>

<!-- Prevent mobile safari on mobile web apps -->
<script>
// Mobile Safari in standalone mode
if(("standalone" in window.navigator) && window.navigator.standalone){
// If you want to prevent remote links in standalone web apps opening Mobile Safari, change 'remotes' to true
var noddy, remotes = false;
document.addEventListener('click', function(event) {
		noddy = event.target;
// Bubble up until we hit link or top HTML element. Warning: BODY element is not compulsory so better to stop on HTML
while(noddy.nodeName !== "A" && noddy.nodeName !== "HTML") {
	        noddy = noddy.parentNode;
	    }
if('href' in noddy && noddy.href.indexOf('http') !== -1 && (noddy.href.indexOf(document.location.host) !== -1 || remotes))
		{
event.preventDefault();
document.location.href = noddy.href;
		}
	},false);
}
</script>

  <!-- Deal with Tweets -->
	<script>
		window.setInterval(function(){
			twttr.widgets.load()
		}, 500);
	</script>

	</body>
</html>
